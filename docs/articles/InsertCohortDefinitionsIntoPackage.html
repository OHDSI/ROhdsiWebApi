<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Insert Cohort Definitions Into Package • ROhdsiWebApi</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Insert Cohort Definitions Into Package">
<meta property="og:description" content="ROhdsiWebApi">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ROhdsiWebApi</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.3.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/authenticationSecurity.html">Using ROhdsiWebApi with security enabled Atlas/WebAPI</a>
    </li>
    <li>
      <a href="../articles/InsertCohortDefinitionsIntoPackage.html">Insert Cohort Definitions Into Package</a>
    </li>
    <li>
      <a href="../articles/UsingROhdsiWebApi.html">Using ROhdsiWebApi</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://ohdsi.github.io/Hades" class="external-link"><img src='https://ohdsi.github.io/Hades/images/hadesMini.png' width=80 height=17 style='vertical-align: top;'></a>
</li>
<li>
  <a href="https://github.com/OHDSI/ROhdsiWebApi/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Insert Cohort Definitions Into Package</h1>
            
            <h4 data-toc-skip class="date">2022-01-31</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/OHDSI/ROhdsiWebApi/blob/HEAD/vignettes/InsertCohortDefinitionsIntoPackage.Rmd" class="external-link"><code>vignettes/InsertCohortDefinitionsIntoPackage.Rmd</code></a></small>
      <div class="hidden name"><code>InsertCohortDefinitionsIntoPackage.Rmd</code></div>

    </div>

    
    
<p>ROhdsiWebApi is part of <a href="https://ohdsi.github.io/Hades" class="external-link">HADES</a>. # Introduction From Package <a href="https://github.com/OHDSI/ROhdsiWebApi/blob/master/README.md" class="external-link">Readme</a></p>
<blockquote>
<p>ROhdsiWebApi maybe used to insert cohort definition json and sql from your Atlas (webapi) instance into your study R package. Two functions in this package support <code>insertCohortDefinitionInPackage</code> and <code>insertCohortDefinitionSetInPackage</code> . Please see documentation for the functions. This vignette focusses on the <code>insertCohortDefinitionsetInPackage</code> function. It depends on a reference file called CohortsToCreate.</p>
</blockquote>
<blockquote>
<p>The <code>insertCohortDefinitionSetInPackage</code> function extracts a set of cohort definitions from your Atlas (webapi) instance and inserts them into your R studio package. It requires as an input a csv file with information about the Cohorts that needs to be inserted called ‘CohortsToCreate.csv’. This file should have three columns - altasId (The cohort Id in Atlas), cohortId (The cohort ID that will be used when instantiating the cohort (can be different from atlasId)), and name (The name to be used for the cohort. This name will be used to generate file names, so please use letters and numbers only (no spaces)). ‘CohortsToCreate.csv’ can take additional optional fields such as ‘cohortName’ but these optional fields will not be used by this function. It maybe used by your study package e.g. ‘cohortName’ maybe used to represent a custom name to identify the cohort in your study.</p>
</blockquote>
<blockquote>
<p>We can easily create ‘CohortsToCreate.csv’, including the optional fields as follows:</p>
</blockquote>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span>
<span class="co"># Set up</span>
<span class="va">baseUrl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"BaseUrl"</span><span class="op">)</span>
<span class="co"># list of cohort ids</span>
<span class="va">cohortIds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">18345</span>,<span class="fl">18346</span><span class="op">)</span>

<span class="co"># get specifications for the cohortIds above</span>
<span class="va">webApiCohorts</span> <span class="op">&lt;-</span>
        <span class="fu">ROhdsiWebApi</span><span class="fu">::</span><span class="fu"><a href="../reference/getCohortDefinitionsMetaData.html">getCohortDefinitionsMetaData</a></span><span class="op">(</span>baseUrl <span class="op">=</span> <span class="va">baseUrl</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">cohortIds</span><span class="op">)</span>

<span class="va">cohortsToCreate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">webApiCohorts</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">cohortId</span> <span class="op">&lt;-</span> <span class="va">webApiCohorts</span><span class="op">$</span><span class="va">id</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>
  <span class="va">cohortDefinition</span> <span class="op">&lt;-</span>
    <span class="fu">ROhdsiWebApi</span><span class="fu">::</span><span class="fu"><a href="../reference/getCohortDefinition.html">getCohortDefinition</a></span><span class="op">(</span>cohortId <span class="op">=</span> <span class="va">cohortId</span>, 
                                      baseUrl <span class="op">=</span> <span class="va">baseUrl</span><span class="op">)</span>
  <span class="va">cohortsToCreate</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>
    atlasId <span class="op">=</span> <span class="va">webApiCohorts</span><span class="op">$</span><span class="va">id</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,
    name <span class="op">=</span> <span class="va">webApiCohorts</span><span class="op">$</span><span class="va">id</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,
    cohortName <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trim.html" class="external-link">str_trim</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trim.html" class="external-link">str_squish</a></span><span class="op">(</span><span class="va">cohortDefinition</span><span class="op">$</span><span class="va">name</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span>

<span class="va">cohortsToCreate</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">cohortsToCreate</span><span class="op">)</span>

<span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_excel_csv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">cohortsToCreate</span>, na <span class="op">=</span> <span class="st">""</span>, 
                       file <span class="op">=</span> <span class="st">"inst/settings/CohortsToCreate.csv"</span>, 
                       append <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<blockquote>
<p>Note in the step above - the only input needed was the list of atlasId, and ROhdsiWebApi was able to populate the rest of fields by pulling that information from your webApi (atlas). Once this file has been created, then use insert function as follows</p>
</blockquote>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Insert cohort definitions from ATLAS into package -----------------------</span>
<span class="fu">ROhdsiWebApi</span><span class="fu">::</span><span class="fu"><a href="../reference/insertCohortDefinitionSetInPackage.html">insertCohortDefinitionSetInPackage</a></span><span class="op">(</span>
  fileName <span class="op">=</span> <span class="st">"inst/settings/CohortsToCreate.csv"</span>,
  baseUrl <span class="op">=</span> <span class="va">baseUrl</span>,
  insertTableSql <span class="op">=</span> <span class="cn">TRUE</span>,
  insertCohortCreationR <span class="op">=</span> <span class="cn">TRUE</span>,
  generateStats <span class="op">=</span> <span class="cn">TRUE</span>,
  packageName <span class="op">=</span> <span class="st">'yourFavoritePackage'</span>
<span class="op">)</span></code></pre></div>
<blockquote>
<p>Now your package should have all the cohort specification in the ‘inst’ folder.</p>
</blockquote>
<blockquote>
<p>IMPORTANT: This function is designed to be used as an ‘extra’ script for your package maintenance, i.e. please call this function in R Studio in project mode - where the project is your package.</p>
</blockquote>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Gowtham Rao, Martijn Schuemie, Jamie Gilbert.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
